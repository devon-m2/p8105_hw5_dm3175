---
title: "p8105_hw5_dm3175"
author: "Devon Morgan"
date: "11/5/2018"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(purrr)

```

# Problem 1

## Load and Clean Data

First, the data from the longitudinal study was loaded and cleaned. The files were originally stored in separate csv files, but were loaded and combined into one dateframe using the `map` function. The `map` functionality iterates over the cells in the file name column to carry out the `read_csv` function, and enters the output into a new column in the data frame. Data was unnested after it was read in. 

Next, data was tidied using the `gather` function to organize all observations by week of observation. Using the information stored in the file name, columns for the `subject_id` and `week` were created. The `group_arm` variable was converted into a factor variable, and the `subject_id` and `week` into numeric. 

```{r message = FALSE}
# Load list of file names into a data frame
longit_file_names = tibble(files = list.files("./data"),
                           path = str_c("./data/", files)) %>% 
  janitor::clean_names() 

# Iterate loading csvs from directory and tidy data
longit_tidy = longit_file_names %>% 
  mutate(patient_data = map(path, read_csv)) %>% 
  unnest() %>% 
  gather(key = week, value = obs, week_1:week_8) %>% 
  separate(files, into = c("group_arm", "subject_id"), sep = "_") %>% 
  mutate(subject_id = str_replace(subject_id, ".csv", ""), 
         week = str_replace(week, "week_", "")) %>% 
  mutate(group_arm = factor(group_arm, levels = c("con", "exp")),
         subject_id = as.double(subject_id), 
         week = as.double(week)) %>% 
  select(group_arm, subject_id, week, obs)

```

## Spaghetti Plot of All Subjects Over Time

A spaghetti plot of all subjects from control and experimental groups over time reveals that control group observations are consistently lower than experimental group observations over time. The differences appear to be diverging more over time, with earlier time points showing more overlap between the groups and later time points showing greater differences. The observation values for the experimental group appears to be increasing over time.

```{r}
longit_tidy %>% 
  group_by(subject_id, group_arm) %>% 
  ggplot(aes(x = week, y = obs, color = group_arm, group = interaction(subject_id, group_arm))) + 
  geom_line(se = FALSE) +
  labs(
    title = "Observations for Each Subject in Control and Experimental Groups, Weeks 1-8",
    x = "Week",
    y = "Observation",
    caption = "Data from the Longitudinal Study"
  ) + 
  theme_bw()

```


# Problem 2

